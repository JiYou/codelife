<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- change dir -->
  <link rel="stylesheet" href="../../../stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="../../../stylesheets/pygment_trac.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="../../../javascripts/script.js"></script>
  <!-- change dir -->

  <title>Codelife</title>
  <meta name="description" content="技术人生">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">OpenStack Deploy</h1>
    </header>
    <div id="container">
      <p class="tagline">
		<!-- TAG 1 -->
		<a href="http://jiyou.github.io/codelife/openstack-deploy/appendix/chap1"> 上一章</a>
		<a href="http://jiyou.github.io/codelife/openstack-deploy/appendix/chap3"> 下一章 </a>
		<!-- TAG 1 -->
	  </p>
      <div id="main" role="main">
        <div class="download-bar">
        	<span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
		<p>作者: Ji You Email: jumail@qq.com</p>
			<h1>

				<a name="codelife" class="anchor" href="#codelife">
				<span class="octicon octicon-link"></span></a>
			</h1>


<!-- 正文 ------------------------>
<h1>附录 virt-manager</h1>
<h1>前提</h1>
<p>进行本节内容之前，应该确认按照第一章《<a href="../../chap1">由零开始</a>》正确安装了virt-manager。以正确无误地进行本节的后续操作。</p>
<h1>准备CentOS-6.5</h1>
<p>将使用virt-manager安装的虚拟机，使用的Linux系统为<strong>CentOS 6.5</strong>。安装的ISO下载链接如下：</p>
<pre><code>    http://isoredirect.centos.org/centos/6/isos/x86_64/
</code></pre>

<p>在这个链接中提供了众多的下载链接，只需要找到一个速度比较快的下载即可。下载完成之后，可以放到不同的介质上安装，比如U盘、DVD光盘。</p>
<p>确保下载的iso文件为：</p>
<pre><code>    CentOS-6.5-x86_64-bin-DVD1.iso
</code></pre>

<p>安装CentOS较为熟悉的读者，可以只关注<strong>粗体</strong>步骤，不熟悉的读者请照步骤进行操作。</p>
<blockquote>
<ul>
<li>
<p>本书所使用的<strong>CentOS 6.5版本</strong>，为了顺利地进行本书的所有实验，请读者务必采用此版本。</p>
</li>
<li>
<p>如果已经准备好了<code>CentOS-6.5-x86_64-bin-DVD1.iso</code>，拷贝至运行virt-manager的物理机。放置于/cloud/_base目录下。</p>
</li>
</ul>
</blockquote>
<pre><code>    # mkdir -p /cloud/_base
    拷贝CentOS-6.5-x86_64-bin-DVD1.iso至/cloud/_base
    # cd /cloud/_base
    # ls
    CentOS-6.5-x86_64-bin-DVD1.iso
</code></pre>

<h1>启动virt-manager</h1>
<h2>Step 1 开启桌面终端</h2>
<p>在CentOS 6.5<strong>桌面环境</strong>中，新开一个终端，如图1所示：</p>
<p><img src="./virt-manager/open-terminal.png" /></p>
<p>图1 在桌面环境新开终端</p>
<p>如果想更加快捷方便地使用终端程序，最好的方式是放置于Panel上。</p>
<p><img src="./virt-manager/terminal.png" /></p>
<p>图2 将Terminal程序放置于Panel上。</p>
<blockquote>
<ul>
<li>virt-mananger是带UI的程序，需要在运行在桌面环境中。利用ssh无法正常启动virt-manager。</li>
</ul>
</blockquote>
<h2>Step 2 切换至root用户</h2>
<p>然后输入如下命令：</p>
<pre><code>    # su -
    Password:   # 输入root用户密码。
</code></pre>

<h2>Step 3 启动virt-manager</h2>
<pre><code>    # virt-manager
</code></pre>

<p><img src="./virt-manager/virt-manager.png" /></p>
<p>图3 启动virt-manager</p>
<p>如果能够成功出现图1.4所示界面，表明virt-manager能够成功启动了。接下来就可以尝试创建一个新的虚拟机了。</p>
<h1>创建虚拟机</h1>
<h2>Step 1 虚拟机名字</h2>
<p>virt-manager正确启动之后，点击<strong>新建</strong>按钮，将会弹出一个对话框。输入<strong>虚拟机名字</strong>vm-centos。然后点击Forward按钮。</p>
<p><img src="./virt-manager/create-vm.png" /></p>
<p>图4 创建新的虚拟机</p>
<blockquote>
<ul>
<li>
<p>要注意的是，虚拟机名字，与虚拟机的<code>hostname</code>是两个概念。虚拟机名字只是用于virt-manager的管理不同虚拟机。虚拟机的<code>hostname</code>是给虚拟机内部的操作系统使用。而虚拟机的<code>hostname</code>主要用于网络主机名的识别。类似人的小名与学名，小名一般在家里面使用，学名适合在学校使用。</p>
</li>
<li>
<p>建议安装虚拟机时，将虚拟机名字与虚拟机的<code>hostname</code>设为一致。设置<code>hostname</code>位于《<a href="./../chap1/">附录 安装CentOS 6.5 Linux操作系统</a>》<strong>设置主机名</strong>小节。</p>
</li>
</ul>
</blockquote>
<h2>Step 2 选择ISO文件</h2>
<h3>第一步 选择iso文件时，点击Browse按钮：</h3>
<p><img src="./virt-manager/choose-iso.png" /></p>
<p>图5 选择iso文件</p>
<h3>第二步 点击Browse Local按钮：</h3>
<p><img src="./virt-manager/choose-iso2.png" /></p>
<p>图6 选择本地文件系统</p>
<h3>第三步 点击File System项：</h3>
<p><img src="./virt-manager/root-fs.png" /></p>
<p>图7 选中File System</p>
<h3>第四步 选中/opt/目录</h3>
<p><img src="./virt-manager/choose-opt.png" /></p>
<p>图8 选中并且进入/opt/目录</p>
<h3>　第五步 选择CentOS iso</h3>
<p><img src="./virt-manager/choose-dvd-iso.png" /></p>
<p>图9 选择CentOS DVD</p>
<h3>第六步 成功选中</h3>
<p><img src="./virt-manager/choose-success.png" /></p>
<p>图10 选择成功</p>
<p>然后点击Forward。</p>
<h2>Step 3 设置内存与VCPU</h2>
<p>根据物理机的情况设置内存与VCPU。一般而言，做实验使用512MB~1024MB内存，1个VCPU足够使用。设置好之后，点击Forward继续。</p>
<p><img src="./virt-manager/choose-mem-vcpu.png" /></p>
<p>图11 选择内存及VCPU</p>
<h2>Step 4 创建磁盘</h2>
<p>根据物理磁盘空间，及实际情况设置虚拟机磁盘大小。一般8G足够可用。如果虚拟机空间不足，后面可以创建虚拟磁盘挂载给虚拟机使用。设置成功之后，点击Forward继续。</p>
<p><img src="./virt-manager/create-disk.png" /></p>
<p>图12 创建磁盘</p>
<h2>Step 5 创建虚拟机</h2>
<p>当前面步骤都完成之后，点击Finish将会创建虚拟机：</p>
<p><img src="./virt-manager/vm-ok.png" /></p>
<p>图13 创建虚拟机</p>
<h2>　Step 6 创建成功</h2>
<p>当弹出如图14，说明创建成功：</p>
<p><img src="./virt-manager/ok-install.png" /></p>
<p>图14 创建虚拟机成功</p>
<h2>Step 7 虚拟机安装操作系统</h2>
<p>请参照《<a href="../chap1/">附录 安装CentOS 6.5 Linux操作系统</a>》进行后续步骤的安装。</p>
<h1>错误处理</h1>
<p>在Step 5，点击Finish之后，有可能遇到图15所示：</p>
<p><img src="./virt-manager/networ-error.png" /></p>
<p>图15 点击Finish，弹出对话框，指明Virtual Network 'default'不可用</p>
<p>点击Yes之后，出现图16所示错误：</p>
<p><img src="./virt-manager/default-network-error.png" /></p>
<p>图16 缺省default网络不可用</p>
<h2>Step 1 Qemu Details</h2>
<p>选中qemu，单击右键，选择Details:</p>
<p><img src="./virt-manager/qemu-details.png" /></p>
<p>图17 Qemu Details</p>
<h2>Step 2 新建网络</h2>
<p>选中Virtual Networks，再点击新建按钮。</p>
<p><img src="./virt-manager/create-new-network.png" /></p>
<p>图18 创建新网络</p>
<h2>Step 3 步骤简介</h2>
<p>点击Forward：</p>
<p><img src="./virt-manager/create-network-forward.png" /></p>
<p>图19 显示大致步骤</p>
<h2>Step 4 设置网络名</h2>
<p>首先输入网络名，只允许字母，下划线，数字。然后点击Forward：</p>
<p><img src="./virt-manager/net-name.png" /></p>
<p>图20 设置网络名</p>
<h2>Step 5 设置网段</h2>
<p>如果以前没有创建过网络，那么使用默认提供的网段，否则请输入一个不重复的网段。然后点击Forward：</p>
<p><img src="./virt-manager/net-type.png" /></p>
<p>图20 设置网段</p>
<h2>Step 6 设置DHCP</h2>
<p>接下来会要求设置DHCP，一般而言，使用默认即可，如果后期虚拟机数量较大，比如200个以上，请将起始IP改小点，并且注意网段与之前的设置一致。然后点击Forward：</p>
<p><img src="./virt-manager/net-ip.png" /></p>
<p>图21 设置网络IP</p>
<h2>　Step 7 网络类型</h2>
<p>选择isolated network，请不要选择第二种类型（需要关掉ethx网卡）。</p>
<p><img src="./virt-manager/isolate-net.png" />)</p>
<p>图22 选择网络类型</p>
<h2>　Step　8 创建网络</h2>
<p>点击Finish按钮：</p>
<p><img src="./virt-manager/ready-to-create.png" /></p>
<p>图23 创建网络</p>
<h2>　Step 9 重新选择网络</h2>
<p>返回出错UI界面，点击Cancel按钮：</p>
<p><img src="./virt-manager/error-back.png" /></p>
<p>图24 点击Cancel按钮</p>
<p><strong>重新新建虚拟机</strong>，并且重新进入如图25界面，选择新建的网络名，点击Finish按钮：</p>
<p><img src="./virt-manager/new-net-vm.png" /></p>
<p>图25 选择新建网络</p>
<h2>　Step　10 安装操作系统</h2>
<p>当弹出如图14，说明创建成功：</p>
<p><img src="./virt-manager/ok-install.png" /></p>
<p>图26 创建虚拟机成功</p>
<p>请参照《<a href="../chap1">附录 安装CentOS 6.5 Linux操作系统</a>》进行后续步骤的安装。</p>

<!-- 正文 -------------------------------->


        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/JiYou" class="avatar"><img src="https://avatars0.githubusercontent.com/u/448253?v=2&amp;s=60" width="48" height="48"></a> <a href="https://github.com/JiYou">JiYou</a> maintains <a href="https://github.com/JiYou/codelife">Codelife</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="http://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/JiYou/codelife/tarball/master" class="tar">tar</a><a href="https://github.com/JiYou/codelife/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

</body>
</html>
