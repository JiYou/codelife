<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- change dir -->
  <link rel="stylesheet" href="../../stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="../../stylesheets/pygment_trac.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="../../javascripts/script.js"></script>
  <!-- change dir -->

  <title>Codelife</title>
  <meta name="description" content="技术人生">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">OpenStack Deploy</h1>
    </header>
    <div id="container">
      <p class="tagline">
	  
		<!-- TAG 1 -->
		<a href="http://jiyou.github.io/codelife/openstack-deploy">回目录</a>
		<a href="http://jiyou.github.io/codelife/openstack-deploy/chap2"> 下一章 </a>
		<!-- TAG 1 -->
		
	  </p>
      <div id="main" role="main">
        <div class="download-bar">
        	<span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
		<p>作者: Ji You Email: jumail@qq.com</p>
			<h1>

				<a name="codelife" class="anchor" href="#codelife">
				<span class="octicon octicon-link"></span></a>
			</h1>


<!-- 正文 ------------------------>
<h1>第一章 由零开始</h1>
<p>很高兴能够从这里开始，无论之前是否接触过OpenStack，或者Linux，哪怕只是听说过云计算。在这里，心里默念几遍“欲速则不达”，非常必要。让心开始静下来，准备开始。</p>
<p>如果读者只是准备利用Windows上的虚拟机搭建OpenStack，可以直接阅读第三章《VirtualBox及其使用》。本章所介绍的知识为利用Linux环境创建虚拟机。</p>
<p>再次重申：</p>
<blockquote>
<ul>
<li>本章节进行的操作都是为了在<strong>真实的Linux物理机</strong>环境上操作虚拟机，请不要在Windows上搭建虚拟机仿真本章实验及操作。</li>
<li>如果有支持VT的物理机可供安装Linux系统，建议从本章开始阅读。</li>
<li>如果读者使用的是Windows环境，请从第三章开始。</li>
</ul>
</blockquote>
<h1>1.1 开启VT</h1>
<p>由于本章所使用的环境都是在真实的物理机上操作，首先要检测的是物理机是否支持VT。</p>
<p>虚拟化技术（Virtualization Techonology, VT），不同的厂商对于虚拟化技术称呼不同，Intel命令为Intel-VT，而AMD称之为AMD-V。本书中统称为VT。</p>
<p>检测是否支持VT，最简单也是最直接的方法，即是启动系统时，进入BIOS，打开CPU选项卡，确保VT处于Enabled状态。如果处于Disabled状态，请务必更改为Enabled状态。正确状态如下图所示：</p>
<p><img src="./bios-vt.png" /></p>
<p>图1.1 BIOS中开启VT</p>
<p>如果没有在BIOS中找到此选项，或者不知道如何开启，请参考以下建议，如果已成功开启，请跳过此建议。</p>
<blockquote>
<ul>
<li>
<p>不同的BIOS对于VT的显示并不相同，有的显示为VT，有的显示为Virtualization，应该注意辨识。</p>
</li>
<li>
<p>如果在BIOS中，没有发现Virtualization字样，应该查询相应CPU型号，以确认使用的CPU是否支持虚拟化。如果BIOS中虚拟化并没有开启，安装KVM之后，KVM模块仍然不能使用。因此，<strong>应该必须保证</strong>VT被开启。</p>
</li>
<li>
<p>如果在BIOS中没有找到VT信息，一种检测CPU是否支持VT的方法是通过命令检测，如果没有任何输出，则表明不支持VT。如果有输出，则表明CPU支持VT，应至BIOS中查找VT选项，并确保开启。</p>
</li>
</ul>
</blockquote>
<pre><code>    egrep -o &quot;(vmx|svm)&quot; /proc/cpuinfo
</code></pre>

<blockquote>
<ul>
<li>除了此项需要设置之外，如果发现<strong>VT-d Tech</strong>选项，也应该将此项开启。VT-d技术表示CPU支持直接I/O访问的虚拟化技术。此项属于加分项，如果没有找到，也并不影响。</li>
</ul>
</blockquote>
<h1>1.2 安装CentOS</h1>
<p>关于CentOS的安装，被移动至了<strong>《<a href="../appendix/chap1/">附录 安装CentOS 6.5 Linux操作系统</a>》</strong>。请参考此步骤进行CentOS 6.5的安装。</p>
<p><strong>特别提醒</strong></p>
<blockquote>
<ul>
<li>物理机的安装，在<strong>服务器类型</strong>一处，本章请选择<strong>Desktop</strong>。如图1.2所示。</li>
<li>如果对于CentOS Linux不是非常熟悉，请务必严格参考附录安装步骤。</li>
</ul>
</blockquote>
<p><img src="./desktop.png" /></p>
<p>图1.2 服务器类型选择Desktop</p>
<p>本书所有的实验都将基于Desktop类型。为了后续章节实验的顺利进行，请务必选择此选项且不要做额外配置。</p>
<blockquote>
<ul>
<li>安装好CentOS 6.5系统之后，为了后续步骤能够正常进行，<strong>不要</strong>配置其他源或者执行<code>yum update</code>。</li>
</ul>
</blockquote>
<h1>1.3 配置离线源</h1>
<p>为了实验正常进行，以及更好的解决依赖问题，已经提供了会用到的所有的离线源。为了使本书所有的实验能够正常运行，请按以下步骤设置离线源。</p>
<h2>Step 1 下载源</h2>
<p>本书会用到的所有的离线源，均放置于<a href="http://pan.baidu.com/s/1gdzixz1">百度云</a> （http://pan.baidu.com/s/1gdzixz1） 中。首先下载此离线
源booksrepo.tar.gz，并且放置于/opt/目录。</p>
<blockquote>
<ul>
<li>为了实验正常进行，请<strong>务必</strong>按照书中目录进行存放。</li>
</ul>
</blockquote>
<h2>Step 2 解压</h2>
<p>首先切换至root用户：</p>
<pre><code>    # whoami
    stacker     # 如果显示为root，而不用再执行`su -`
    # su -
    Password:   # 输入root用户密码。
</code></pre>

<p>利用root用户，运行如下命令：</p>
<pre><code>    # cd /opt
    # tar zxf booksrepo.tar.gz
    # ls 
    booksrepo  booksrepo.tar.gz #此处为命令的输出结果。
</code></pre>

<h2>Step 3 建立源</h2>
<p>建立离线源，首先需要移除旧有的源：</p>
<pre><code>    # cd /etc/yum.repos.d
    # mkdir -p /root/saved.repo
    # mv *.repo /root/saved.repo
</code></pre>

<p>新建文件booksrepo.repo：</p>
<pre><code>    # cd /etc/yum.repos.d
    # vim booksrepo.repo
    [booksrepo]
    name=booksrepo
    baseurl=file:///opt/booksrepo/
    gpgcheck=0
    enabled=1
    proxy=_none_
</code></pre>

<blockquote>
<ul>
<li>对vim不熟悉的读者，当进入vim之后，按一下i就可以正常编辑啦。</li>
<li>注意每一行的开头没有空格或者Tab。如果有，请删除多余的空格或者Tab。</li>
</ul>
</blockquote>
<h2>Step 4 更新源</h2>
<p>接下来可以使用离线源：</p>
<pre><code>    # yum clean all &amp;&amp; yum makecache
    Loaded plugins: fastestmirror, refresh-packagekit, security
    Cleaning repos: booksrepo total
    Cleaning up Everything
    Cleaning up list of fastest mirrors
    Loaded plugins: fastestmirror, refresh-packagekit, security
    Determining fastest mirrors
    booksrepo                                                                                | 2.9 kB     00:00 ... 
    booksrepo/filelists_db                                                                   |  33 kB     00:00 ... 
    booksrepo/primary_db                                                                     |  55 kB     00:00 ... 
    booksrepo/other_db                                                                       |  38 kB     00:00 ... 
    Metadata Cache Created
</code></pre>

<p>具体输出可能会有所不同，但是只要看到有<strong>Metadata Cache Created</strong>则表明离线源创建成功。</p>
<h1>1.4 安装KVM</h1>
<p>KVM是整个OpenStack开源云的基石之一，可能说是最重要的一块。能熟练地使用KVM，云计算也就会了一半了。KVM主要的功能是能够在一个<strong>Linux操作系统</strong>上运行多个虚拟机。</p>
<blockquote>
<ul>
<li>Windows上无法安装KVM。KVM相当于Linux界的vmware。当然，它是开源且免费的。</li>
</ul>
</blockquote>
<h2>Step 1 检测yum</h2>
<p>首先应该检测yum是否被正确配置。如果没有配置离线源，请返回上一节配置离线源。</p>
<pre><code>    # yum makecache &amp;&amp; yum search kvm
    Loaded plugins: fastestmirror, refresh-packagekit, security
    Loading mirror speeds from cached hostfile
    booksrepo                                                                                | 2.9 kB     00:00 ... 
    Metadata Cache Created
    Loaded plugins: fastestmirror, refresh-packagekit, security
    Loading mirror speeds from cached hostfile
    =============================================== N/S Matched: kvm ===============================================
    qemu-kvm.x86_64 : Userspace component of KVM
    xnba-kvm.x86_64 : xNBA loader for virtual guests

    Name and summary matches only, use &quot;search all&quot; for everything.
</code></pre>

<p>配置正确将会看到相应输出，具体环境不同，可能输出不同。只要能找到qemu-kvm即是成功。</p>
<h2>Step 2 安装KVM，Libvirt，virt-manager</h2>
<pre><code>    # yum install -y kvm libvirt virt-manager
    ......
    Complete!
</code></pre>

<p>如果出现<strong>Complete!</strong>则表明安装成功。</p>
<h2>Step 3 启动Libvirtd</h2>
<pre><code>    # service libvirtd start
    Starting libvirtd daemon:                                  [  OK  ]
</code></pre>

<p>如果出现<strong>[OK]</strong>则表明启动成功。</p>
<h1>1.5 virt-manager</h1>
<p>对于刚接触KVM的读者而言，建立虚拟机的使用virt-manager是最好的选择。请参考以下步骤使用virt-manager。</p>
<h2>Step 1 开启桌面终端</h2>
<p>在CentOS 6.5<strong>桌面环境</strong>中，新开一个终端，如图1.3所示：</p>
<p><img src="./open-terminal.png" /></p>
<p>图1.3 在桌面环境新开终端</p>
<blockquote>
<ul>
<li>virt-mananger是带UI的程序，需要在运行在桌面环境中。利用ssh无法正常启动virt-manager。</li>
</ul>
</blockquote>
<h2>Step 2 切换至root用户</h2>
<p>然后输入如下命令：</p>
<pre><code>    # su -
    Password:   # 输入root用户密码。
</code></pre>

<h2>Step 3 启动virt-manager</h2>
<pre><code>    # virt-manager
</code></pre>

<p><img src="./virt-manager.png" /></p>
<p>图1.4 启动virt-manager</p>
<p>如果能够成功出现图1.4所示界面，表明virt-manager能够成功启动了。接下来就可以尝试创建一个新的虚拟机了。</p>
<h1>1.6 创建虚拟机</h1>
<p>详细地创建虚拟机的步骤，可以参考《<a href="../appendix/virt-manager.md">附录 virt-manager创建虚拟机</a>》。</p>
<h1>1.7 小结</h1>
<p>至此，第一章结束。在本章中简单地介绍了本书会用到的环境，以及如何利用virt-manager创建一个新的虚拟机。已经有了一个很好的起点。</p>
<p>那么，在云计算中，是如何做到快速地创建一个虚拟机呢？不需要手动操作呢？又是如何安装操作系统的呢？那么请看下一章。</p>

<!-- 正文 -------------------------------->


        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/JiYou" class="avatar"><img src="https://avatars0.githubusercontent.com/u/448253?v=2&amp;s=60" width="48" height="48"></a> <a href="https://github.com/JiYou">JiYou</a> maintains <a href="https://github.com/JiYou/codelife">Codelife</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="http://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/JiYou/codelife/tarball/master" class="tar">tar</a><a href="https://github.com/JiYou/codelife/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

</body>
</html>
